<div style=" margin-top: 3vh; padding:15px;">
  <div class="row">
    <h1 class="page-title"> <%= @gym.name %>
        <small>Member Since: 01/01/2017</small>
    </h1>
  </div>
  <!-- <div class="col-xs-12"> -->


  <!-- <div class="row">
    <div class="page-bar">
                    <ul class="page-breadcrumb">
                        <li>
                            <i class="icon-home"></i>
                            <a href="index.html">Home</a>
                            <i class="fa fa-angle-right"></i>
                        </li>
                        <li>
                            <span>Dashboard</span>
                        </li>
                    </ul>
                    <div class="page-toolbar">
                        <div class="btn-group pull-right">
                            <button type="button" class="btn btn-fit-height grey-salt dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true"> Actions
                                <i class="fa fa-angle-down"></i>
                            </button>
                            <ul class="dropdown-menu pull-right" role="menu">
                                <li>
                                    <a href="#">
                                        <i class="icon-bell"></i> Action</a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="icon-shield"></i> Another action</a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="icon-user"></i> Something else here</a>
                                </li>
                                <li class="divider"> </li>
                                <li>
                                    <a href="#">
                                        <i class="icon-bag"></i> Separated link</a>
                                </li>
                            </ul>
                        </div>
                    </div>
    </div>
  </div> -->
    <!-- </div> -->
  <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat dashboard-stat-v2">
          <%= image_tag( @gym.image? ? @gym.image.url(:thumb) : 'logo-placeholder.png', class: "img-responsive", style: "width: 100%; max-height: 120px; object-fit: cover") %>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
          <a class="dashboard-stat dashboard-stat-v2 red" href="#">
              <div class="visual">
                  <i class="fa fa-bar-chart-o"></i>
              </div>
              <div class="details">
                  <div class="number">
                      <span data-counter="counterup" data-value="12,5"><%= @gym_users.count %></span> </div>
                  <div class="desc"> Total Users </div>
              </div>
          </a>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
          <a class="dashboard-stat dashboard-stat-v2 green" href="#">
              <div class="visual">
                  <i class="fa fa-shopping-cart"></i>
              </div>
              <div class="details">
                  <div class="number">
                      <span data-counter="counterup" data-value="549"><%= @gym.push_notifications.count %></span>
                  </div>
                  <div class="desc"> Push Notifications </div>
              </div>
          </a>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
          <a class="dashboard-stat dashboard-stat-v2 purple" href="#">
              <div class="visual">
                  <i class="fa fa-globe"></i>
              </div>
              <div class="details">
                  <div class="number"> +
                      <span data-counter="counterup" data-value="89"></span><%= @monthly_popularity %>% </div>
                  <div class="desc"> Monthly Growth</div>
              </div>
          </a>
      </div>
  </div>

</div>
<div class="col-sm-12">
  <!-- BEGIN BORDERED TABLE PORTLET-->
  <div class="portlet light portlet-fit ">
      <div class="portlet-title">
          <div class="caption">
              <span class="caption-subject sbold uppercase" style="color: #455A64 !important"><%= @gym.name %></span>
          </div>
          <div class="actions">
              <div class="btn-group btn-group-devided" >
                <%= link_to 'Edit Gym', edit_gym_path(@gym), class:"btn green btn-outline btn-sm active", style: "color: white;text-decoration:none"%>
              </div>
          </div>
      </div>
      <div class="portlet-body" style="padding-top: 0;">
          <div class="table-scrollable table-scrollable-borderless" style="overflow: visible;">
              <table class="table table-hover table-light">
                  <thead>
                      <tr class="uppercase" >
                          <th style="color: #455A64"> # </th>
                          <th style="color: #455A64"> Gym Name </th>
                          <th style="color: #455A64"> Access Code </th>
                          <th style="text-align:center; color: #455A64"> Status </th>
                          <th style="text-align:center; color: #455A64"> Actions </th>
                      </tr>
                  </thead>
                  <tbody>
                    <% @gym.push_notifications.each_with_index  do |notification, index| %>
                      <tr>
                          <td><%= index+1 %></td>
                          <td><%= notification.message %></td>
                          <td><%= notification.user_id %></td>

                          <!-- <td><%= gym.active %></td> -->
                          <td>
                            <div class="actions" style="text-align:center">
                              <div class="btn-group">
                                  <a class="btn dark btn-outline btn-circle btn-sm" href="javascript:;" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" style="text-decoration: none;"> Actions
                                      <i class="fa fa-angle-down"></i>
                                  </a>
                                  <ul class="dropdown-menu pull-right">

                                    <li class="divider"> </li>
                                    <li>
                                        <a href="javascript:;">Delete</a>
                                    </li>
                                  </ul>
                              </div>
                          </div>
                         </td>
                      </tr>
                    <% end %>
                  </tbody>
              </table>
          </div>
      </div>
  </div>
  <!-- END BORDERED TABLE PORTLET-->
</div>

<p>
  <strong>Name of Gym:</strong>
  <%= @gym.name %>
</p>
<p>
  <%= @gym.created_at.strftime("Member Since: %m/%d/%Y") %>
</p>
<% if @gym.image?%>
  <br />
  <%= image_tag @gym.image.url(:thumb) %>
  <br />
<% else %>
  <p>
    <strong>NO LOGO UPLOADED</strong>
  </p>
<% end %>
<p>
  <strong>Gym Access Code (For Users):</strong>
  <%= @gym.access_code %>
</p>
<p>
  <strong>Contact Email:</strong>
  <%= @gym.contact_email %>
</p>
<p>
  <strong>Phone:</strong>
  <%= @gym.phone %>
</p>
<p>
  <strong>Location:</strong>
  <%= @gym.location %>
</p>
<p>
  <strong>Hours of Operation:</strong>
  <%= @gym.hours_of_operation %>
</p>

<button id='linkButton'>Open Plaid Link</button>

<script src="https://cdn.plaid.com/link/stable/link-initialize.js"></script>
<script>
// ---------Plaid Support-----------
var linkHandler = Plaid.create({
  env: 'tartan',
  clientName: 'My Gym Connect',
  key: '7201f0759c970f392be584a23d38e4',
  product: 'auth',
  selectAccount: true,
  onSuccess: function(public_token, metadata) {
    // Send the public_token and account ID to your app server.

    var params = {
        public_token: public_token,
        account_id: metadata.account_id,
        // centAmount: 4000

      };
      // TODO find gym_id before now
    $.post('<%= Rails.application.routes.url_helpers.gyms_path %>/' + '<%= @gym.id %>' + "/subscription", params)
      .done( function(data, status, xhr) {
        // setMessage('The Face of Giving team would like to thank you for your donation and we hope you enjoy your selfie!');
        // hideLoading();
        console.log("SUCCESSFUL CREATION OF SUBSCRIPTION");
        alert("alert successful plaid stripe");
      })
      .fail( function(xhr, status, err) {
        console.log("FAILED SUBSCRIPTION");
        alert("sub failed");
        // hideLoading();
        // setMessage('Uh oh we had a problem with your payment. Please try your donation again shortly or contact support@creativechatter.com to complete your donation.  Your selfie number is ' + selfie_id);
        // // showUploadSelfieButton();
        // // clearUploadSelfieButtonEvents();
        // clearPaySelfieButtonEvents();
        // $('#pay-selfie').click(function(){processing = false;});
        // $('#pay-selfie').click(openPayHandler(handler));
      });
  },
  onExit: function(err, metadata) {
      // The user exited the Link flow.
      if (err != null) {
        // The user encountered a Plaid API error prior to exiting.
      }
      // metadata contains information about the institution
      // that the user selected and the most recent API request IDs.
      // Storing this information can be helpful for support.
    }
});

// Trigger the Link UI
document.getElementById('linkButton').onclick = function() {
  linkHandler.open();
};

</script>
